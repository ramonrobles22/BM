CREATE PROCEDURE [dbo].[PLD_BatchCargaComplementarios_Cliente]   
AS  
  
DECLARE @REGISTROS_AFECTADOS AS INT     
DECLARE @FECHAHORA  AS DATETIME     
DECLARE @PROCESO AS CHAR(50)     
DECLARE @FH_INI AS DATETIME     
DECLARE @FH_FIN AS DATETIME     
DECLARE @QUERY AS NVARCHAR(1000)     
     
SET @PROCESO = 'PLD_BatchCargaComplementarios_Cliente'     
SET @FECHAHORA = GETDATE()     
SET @FH_INI=(SELECT FH_INI FROM PLD_FECHASPROCESO WITH(NOLOCK) WHERE ID_PRO='D')     
SET @FH_FIN=(SELECT FH_FIN FROM PLD_FECHASPROCESO WITH(NOLOCK) WHERE ID_PRO='D')     
    
EXEC PLD_BatchBitacoraProcesos @PROCESO, 'INICIADO', @FECHAHORA, 0     
  
DELETE PLD_Complementarios_Cliente WHERE Fh_Registro BETWEEN @FH_INI AND @FH_FIN     
   
--INSERT INTO PLD_Complementarios_Cliente    
-- (Nu_Cliente,Fh_Registro,StatusCarga,Genero,Edo_Civil,Entidad_Nac,Pais_Residencia,Mail)    
--SELECT NUM_CUS, DAT_CUSREG, 'I' , GENDER, MRST, ' ', ' ',' '  
--FROM PRODUCCION.MAZP.MAZP.PEDT001 WITH(NOLOCK)     
--WHERE DAT_CUSREG BETWEEN CONVERT(CHAR(10),@FH_INI,120) AND CONVERT(CHAR(10),@FH_FIN,120)  
     
SET @REGISTROS_AFECTADOS = @@ROWCOUNT      
SET @FECHAHORA = GETDATE()     
EXEC PLD_BatchBitacoraProcesos @PROCESO, 'PEDT001', @FECHAHORA, @REGISTROS_AFECTADOS     
     
--UPDATE PLD_Complementarios_Cliente   
--SET Entidad_Nac = SUBSTRING(BIRTHPL,(LEN(BIRTHPL)-1),LEN(BIRTHPL)),     
-- Pais_Residencia =COD_RESNAT,     
-- Mail = RTRIM(E_MAIL)    
--FROM PRODUCCION.MAZP.MAZP.pedt002 WITH(NOLOCK)   
--WHERE DAT_CUSREG BETWEEN CONVERT(CHAR(10),@FH_INI,120) AND CONVERT(CHAR(10),@FH_FIN,120)  
-- AND NUM_CUS = NU_CLIENTE  
-- AND StatusCarga = 'I'  
     
SET @REGISTROS_AFECTADOS = @@ROWCOUNT  
  
SET @FECHAHORA = GETDATE()     
EXEC PLD_BatchBitacoraProcesos @PROCESO, 'PEDT002', @FECHAHORA, @REGISTROS_AFECTADOS     
     
UPDATE PLD_Complementarios_Cliente     
SET StatusCarga = 'F'     
WHERE StatusCarga = 'I'      
     
SET @FECHAHORA = GETDATE()     
EXEC PLD_BatchBitacoraProcesos @PROCESO, 'FINALIZADO', @FECHAHORA, @REGISTROS_AFECTADOS      